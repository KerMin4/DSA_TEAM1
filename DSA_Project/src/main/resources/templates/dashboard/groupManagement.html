<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>그룹관리</title>
    <link th:href="@{/css/header.css}" rel="stylesheet">
    <link th:href="@{/css/main.css}" rel="stylesheet"> 
    <link th:href="@{/css/mypage.css}" rel="stylesheet">
    <link th:href="@{/css/groupManagement.css}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="/kkirikkiri/js/jquery-3.7.1.min.js"></script>
    <script th:src="@{/js/groupManagement.js}"></script>
</head>
<body class="group-management-page">
   
    <div th:replace="~{fragments/header :: header}"></div>

    <div class="mypage-container">
        <nav class="mypage-nav">
            <ul>
                <li><a th:classappend="${activePage == 'home'} ? 'active'" th:href="@{/dashboard/mypage}" id="home">홈</a></li>
                <li><a th:classappend="${activePage == 'profile-edit'} ? 'active'" th:href="@{/dashboard/profileedit}" id="profile-edit">프로필 수정</a></li>
                <li><a th:classappend="${activePage == 'group-management'} ? 'active'" th:href="@{/dashboard/groupManagement}" id="group-management">그룹 관리</a></li>
                <li><a th:classappend="${activePage == 'payment-management'} ? 'active'" th:href="@{/dashboard/paymentManagement}" id="payment-management">결제 관리</a></li>
            </ul>

            <th:block sec:authorize="isAuthenticated()">
                <div class="profile-section">
                    <img th:src="${#authentication.principal.profileImage != null ? '/kkirikkiri/upload/' + #authentication.principal.profileImage : '/kkirikkiri/upload/default.png'}"
                         alt="프로필 이미지" class="mypage-profile-img" id="profileImg" />
                </div>
                <p th:text="${#authentication.principal.name}" class="profile-nickname"></p>
            </th:block>

            <div class="horizontal-line"></div>
        </nav>

        <div class="group-list-container">
        
            <!-- 여기부터 생성된 그룹 -->
            <div class="group-list-section">
                <h1 class="group-title"></h1>
                <div th:if="${createdGroups.isEmpty()}"></div>
                <div th:each="group : ${createdGroups}">
                    <div class="group-card">
                        <img th:src="@{/upload/{imagePath}(imagePath=${group.profileImage})}" alt="그룹 이미지" class="group-image">
                        <div class="group-text">
                            <h2 th:text="${group.groupName}"></h2>
                            <p th:text="${group.description}"></p>
                            <p>위치: <span th:text="${group.location}"></span></p>
                            <!-- 현재 인원수 / 설정 인원수 추가 -->
                            <p>
                                <i class="fas fa-user-friends"></i> 
                                <span th:text="${memberCountMap[group.groupId]}"></span>
                                /
                                <span th:text="${group.memberLimit}"></span>
                            </p>
                        </div>
                        <div class="dropdown-card">
                            <button class="dropdown-btn">⋮</button>
                            <div class="dropdown-content">
                                <form th:action="@{/dashboard/deleteGroup}" method="post">
                                    <input type="hidden" name="groupId" th:value="${group.groupId}">
                                    <button type="submit" class="delete-btn">삭제</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 여기부터 가입한 그룹 -->
            <div class="group-list-section joined-group-section">
                <h1 class="group-title"></h1>
                <div th:if="${joinedGroups.isEmpty()}"></div>
                <div th:each="group : ${joinedGroups}">
                    <div class="group-card joined-group-card">
                        <img th:src="@{/upload/{imagePath}(imagePath=${group.profileImage})}" alt="그룹 이미지" class="group-image">
                        <div class="group-text">
                            <h2 th:text="${group.groupName}"></h2>
                            <p th:text="${group.description}"></p>
                            <p>위치: <span th:text="${group.location}"></span></p>
               
                            <p>
                                <i class="fas fa-user-friends"></i> 
                                <span th:text="${memberCountMap[group.groupId]}"></span>
                                /
                                <span th:text="${group.memberLimit}"></span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
