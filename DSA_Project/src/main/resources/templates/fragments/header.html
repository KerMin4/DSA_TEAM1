<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Header</title>
    <link th:href="@{/css/header.css}" rel="stylesheet">
    <script th:src="@{/js/dropdown.js}"></script>
    <script th:src="@{/js/notification.js}"></script>
    <script>

    	document.getElementById('notification-btn').addEventListener('click', () => {
        const userId = document.getElementById('notification-btn').getAttribute('data-user-id');
        console.log('ÏïåÎ¶º Î≤ÑÌäº ÌÅ¥Î¶≠Îê®:', userId);

        fetch(`/notifications/markAsRead?userId=${userId}`, { method: 'POST' })
            .then(response => {
                if (response.ok) {
                    document.getElementById('notification-badge').style.display = 'none';
                } else {
                    console.error('ÏïåÎ¶º ÏùΩÏùå Ï≤òÎ¶¨ Ïã§Ìå®');
                }
            })
            .catch(error => console.error('ÏóêÎü¨ Î∞úÏÉù:', error));
    });

    </script>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li class="left-logo">
                    <a th:href="@{/}">Kkiri</a>
                </li>

                <div class="center-menu">
                    <li><a th:href="@{/socialgroup/socialing}">ÏÜåÏÖúÎßÅ</a></li>
                    <li><a th:href="@{/trend/trend}">Ìä∏Î†åÎìú</a></li>
                    <li><a th:href="@{/place/placeMain}">ÌîåÎ†àÏù¥Ïä§</a></li>
                </div>

                <div class="right-menu">
                    <th:block sec:authorize="not isAuthenticated()">
                        <li><a th:href="@{/member/loginForm}">Login</a></li>
                        <li><a th:href="@{/member/joinForm1}">Join</a></li>
                    </th:block>

                    <th:block sec:authorize="isAuthenticated()">

                    	<li>
                    		<a id="notification-btn" th:data-user-id="${#authentication.principal.id}" th:href="@{/notifications}">
   							 üîî ÏïåÎ¶º <span id="notification-badge" style="display: inline;">üî¥</span>
							</a>
                        <!-- Ïó¨Í∏∞Î∂ÄÌÑ∞ Î°úÍ∑∏Ïù∏ ÌõÑ -->
                        

                    
                        <!-- Î°úÍ∑∏Ïù∏ ÌõÑ ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ ÌëúÏãú -->

                        <li class="dropdown">
                            <!-- ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÏùÑ Îïå -->
                            
                            <th:block th:if="${#authentication.principal.profileImage != null}">
                             <img th:src="${#authentication.principal.profileImage != null ? '/kkirikkiri/upload/' + #authentication.principal.profileImage : '/kkirikkiri/upload/default.png'}"
                              alt="ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ" class="profile-img" id="profileImg" />
                            </th:block>


                            <!-- ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏùÑ Îïå Í∏∞Î≥∏ Ïù¥ÎØ∏ÏßÄ ÌëúÏãú -->
                            <th:block th:if="${#authentication.principal.profileImage == null}">
                                <img th:src="@{/images/default.png}" 
                                     alt="Í∏∞Î≥∏ ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ" class="profile-img" id="profileImg" />
                            </th:block>

                            <ul class="dropdown-menu" id="profileDropdown">
                                <li><a th:href="@{/dashboard/mypage}">Ìôà</a></li>
                                <li><a th:href="@{/dashboard/profileedit}">ÌîÑÎ°úÌïÑ ÏàòÏ†ï</a></li>
                                <li><a th:href="@{/dashboard/groupManagement}">Í∑∏Î£π Í¥ÄÎ¶¨</a></li>
                                <li><a th:href="@{/dashboard/paymentManagement}">Í≤∞Ï†ú Í¥ÄÎ¶¨</a></li>
                                <li><a th:href="@{/dashboard/bookingHistory}">ÏòàÏïΩ ÎÇ¥Ïó≠</a></li>
                                <li><a th:href="@{/member/logout}">Logout</a></li>
                            </ul>
                        </li>
                    </th:block>
                </div>
            </ul>
        </nav>
    </header>
</body>
</html>
