<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Header</title>
    <link th:href="@{/css/header.css}" rel="stylesheet">
    <script th:src="@{/js/dropdown.js}"></script>
    <script th:src="@{/js/notification.js}"></script>
    <script>
    	document.getElementById('notification-btn').addEventListener('click', () => {
        const userId = document.getElementById('notification-btn').getAttribute('data-user-id');
        console.log('알림 버튼 클릭됨:', userId);

        fetch(`/notifications/markAsRead?userId=${userId}`, { method: 'POST' })
            .then(response => {
                if (response.ok) {
                    document.getElementById('notification-badge').style.display = 'none';
                } else {
                    console.error('알림 읽음 처리 실패');
                }
            })
            .catch(error => console.error('에러 발생:', error));
    });
    </script>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li class="left-logo">
                    <a th:href="@{/}">Kkiri</a>
                </li>

                <div class="center-menu">
                    <li><a th:href="@{/socialgroup/socialing}">소셜링</a></li>
                    <li><a href="#">트렌드</a></li>
                    <li><a href="#">플레이스</a></li>
                </div>

                <div class="right-menu">
                    <th:block sec:authorize="not isAuthenticated()">
                        <li><a th:href="@{/member/loginForm}">Login</a></li>
                        <li><a th:href="@{/member/joinForm1}">Join</a></li>
                    </th:block>

                    <th:block sec:authorize="isAuthenticated()">
                    	<li>
                    		<a id="notification-btn" th:data-user-id="${#authentication.principal.id}" th:href="@{/notifications}">
   							 🔔 알림 <span id="notification-badge" style="display: inline;">🔴</span>
							</a>
                        <!-- 여기부터 로그인 후 -->
                        
                        <li class="dropdown">
                            <img th:src="${#authentication.principal.profileImage != null ? '/kkirikkiri/upload/' + #authentication.principal.profileImage : '/kkirikkiri/upload/default.png'}"
                                 alt="프로필 이미지" class="profile-img" id="profileImg" />

                            <ul class="dropdown-menu" id="profileDropdown">
                                <li><a th:href="@{/dashboard/mypage}">홈</a></li>
                                <li><a th:href="@{/dashboard/profileedit}">프로필 수정</a></li>
                                <li><a th:href="@{/dashboard/groupManagement}">그룹 관리</a></li>
                                <li><a th:href="@{/dashboard/paymentManagement}">결제 관리</a></li>
                                <li><a th:href="@{/member/logout}">Logout</a></li>
                            </ul>
                        </li>
                    </th:block>
                </div>
            </ul>
        </nav>
    </header>
</body>
</html>
