<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
	<style>
	/* ======================= 멤버 리스트 스타일 ======================= */
	.members-list {
	    list-style-type: none; /* 불릿 포인트 제거 */
	    padding-left: 0; /* 기본 패딩 제거 */
	}
	
	.members-list li {
	    display: flex; /* flex를 사용하여 가로로 정렬 */
	    align-items: center; /* 이미지와 텍스트가 세로로 중앙 정렬되도록 설정 */
	    margin-bottom: 10px; /* 리스트 아이템 간의 간격 설정 */
	}
	
	.members-list li img {
	    width: 40px; /* 프로필 이미지 크기 설정 */
	    height: 40px;
	    border-radius: 50%; /* 이미지를 동그랗게 */
	    margin-right: 10px; /* 이미지와 텍스트 사이의 간격 설정 */
	}
	
	.members-list li span {
	    font-size: 14px; /* 텍스트 크기 설정 */
	}
	</style>
	<script th:inline="javascript">
		/* 페이지가 로드될 때 동적으로 멤버 리스트를 로드하는 함수 */
		$(document).ready(function() {

			// groupId 값을 페이지에서 가져옴
	        var groupId = /*[[${groupId}]]*/ 0; // Thymeleaf에서 groupId를 받아옴
	        console.log("groupId:", groupId); // groupId 값 확인용 로그
	        
	        // groupId가 존재하면 멤버 리스트를 로드
	        if (groupId) {
	            loadMembers(groupId);
	        }
		    	
	        function loadMembers(groupId) {
		    	$.ajax({
		    	    url: '/socialgroup/members', // 실제 멤버 리스트를 가져오는 서버 URL 설정
		    	    type: 'GET',
		    	    data: { groupId: groupId },
		    	    success: function(response) {
		    	    	console.log("서버 응답:", response);
		    	        var memberList = $('.members-list');
		    	        memberList.empty(); // 기존 멤버 리스트 비우기
		    	        $.each(response, function(index, member) { // response 자체가 멤버 리스트임
		    	            var listItem = `
		    	                <li>
		    	                    <img src="/upload/${member.profileImage ? member.profileImage : 'defaultProfile.png'}" 
		    	                         alt="프로필 이미지" class="profile-img">
		    	                    <span>${member.userId}</span>
		    	                </li>`;
		    	            memberList.append(listItem);
		    	        });
		    	    },
		    	    error: function(xhr, status, error) {
		    	    	console.error("Ajax 호출 오류:", error);
		    	        alert('멤버 리스트를 불러오는데 실패했습니다.');
		    	    }
		    	});
		    }
		});
	</script>
</head>
<body>
	<div th:fragment="sidebarFragment">
		<div class="sidebar">
	        <h2>그룹 게시판</h2>
            
            <br>
            
            <h2 th:text="${groupName}"></h2>

            <div>가입 멤버</div>
            <ul class="members-list">
			    <li th:each="member : ${members}">
			        <img th:src="@{/upload/{profileImage}(profileImage=${member.profileImage})}" alt="프로필 이미지" class="profile-img">
			        <span th:text="${member.userId}"></span>
			    </li>
			</ul>
	    </div>
    </div>
</body>
</html>